import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import React from 'react';
import { useNavigate } from 'react-router-dom';
import Card from '../components/Card';
import { load } from '../lib/storage';
import { initialState } from '../lib/state';
import { pitTax, marginalRate, progressiveGrossUp } from '../lib/tax';
import { RULINGS } from '../data/rulings';
import ExportPDF from '../components/ExportPDF';
import { useAuth } from '../lib/auth';
import { isUltra } from '../lib/roles';
import { toast } from '../lib/toast';
function Num({ v, forceNeg }) {
    if (v === undefined || Number.isNaN(v))
        return _jsx("span", { className: "block text-right", children: "-" });
    const neg = forceNeg === true || v < 0;
    const absVal = Math.abs(v);
    const txt = absVal.toLocaleString('th-TH', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
    return _jsxs("span", { className: ['block text-right tabular-nums', neg ? 'text-[#FF7B7B]' : ''].join(' '), children: [neg ? '-' : '', txt] });
}
const fmt = (n) => n === undefined || Number.isNaN(n) ? '-' : n.toLocaleString('th-TH', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
export default function ProposalBuilder() {
    // ✅ Ultra เท่านั้น
    const { user } = useAuth();
    const navigate = useNavigate();
    const allow = !!user && isUltra(user.plan);
    React.useEffect(() => {
        if (!allow) {
            toast('ฟีเจอร์ “Proposal” ใช้ได้เฉพาะแผน Ultra');
            navigate('/pricing', { replace: true });
        }
    }, [allow, navigate]);
    if (!allow)
        return null;
    const data = React.useMemo(() => load(initialState), []);
    const c = data.company;
    const ds = c.directors;
    // Inputs
    const income = c.companyIncome ?? 0;
    const expense = c.companyExpense ?? 0;
    const interest = c.interestExpense ?? 0;
    const actualCIT = c.actualCIT ?? 0;
    const taxYear = c.taxYear;
    // Directors totals
    const personalExpense = 100000;
    const personalAllowance = 160000;
    const totalPremium = ds.reduce((s, d) => s + (d.personalInsurancePremium ?? 0), 0);
    const gus = ds.map(d => {
        const base = d.annualSalary ?? 0;
        const prem = d.personalInsurancePremium ?? 0;
        const g = progressiveGrossUp(base, prem, personalExpense + personalAllowance);
        const taxable = Math.max(0, base + prem + g - (personalExpense + personalAllowance));
        const r = marginalRate(taxable);
        return { id: d.id, name: d.name, base, prem, g, rate: r };
    });
    const totalGrossUp = gus.reduce((s, g) => s + g.g, 0);
    // Corporate tax model
    const CIT_RATE = 0.20;
    const pbt_before = income - expense - interest;
    const pbt_afterPrem = income - totalPremium - expense - interest;
    const pbt_afterPremGross = income - totalPremium - totalGrossUp - expense - interest;
    const cit_before = Math.max(0, pbt_before) * CIT_RATE;
    const cit_afterPrem = Math.max(0, pbt_afterPrem) * CIT_RATE;
    const cit_afterPremGross = Math.max(0, pbt_afterPremGross) * CIT_RATE;
    // Infer add-back (disallow) from actual tax
    const disallow_tax_before = Math.max(0, actualCIT - cit_before);
    const disallow_base = disallow_tax_before / CIT_RATE;
    const disallow_afterPrem = Math.max(0, disallow_base - totalPremium);
    const disallow_afterPremGross = Math.max(0, disallow_base - totalPremium - totalGrossUp);
    const disallow_tax_afterPrem = disallow_afterPrem * CIT_RATE;
    const disallow_tax_afterPremGross = disallow_afterPremGross * CIT_RATE;
    // True tax by scenarios
    const trueTax_before = actualCIT;
    const trueTax_afterPrem = cit_afterPrem + disallow_tax_afterPrem;
    const trueTax_afterPremGross = cit_afterPremGross + disallow_tax_afterPremGross;
    // Savings
    const taxSaved_afterPrem = Math.max(0, trueTax_before - trueTax_afterPrem);
    const taxSaved_afterPremGross = Math.max(0, trueTax_before - trueTax_afterPremGross);
    const taxSavedPct_afterPrem = trueTax_before > 0 ? (taxSaved_afterPrem / trueTax_before) * 100 : 0;
    const taxSavedPct_afterPremGross = trueTax_before > 0 ? (taxSaved_afterPremGross / trueTax_before) * 100 : 0;
    const combinedCost = totalPremium + totalGrossUp;
    const otherCosts_before = expense + interest;
    const otherCosts_afterPrem = expense + interest;
    const otherCosts_afterPremGross = expense + interest;
    return (_jsxs("main", { className: "mx-auto max-w-6xl px-6 py-10", children: [_jsxs("div", { className: "mb-6 flex items-center justify-between gap-3", children: [_jsxs("div", { children: [_jsx("h2", { className: "text-xl font-semibold text-gold", children: "Proposal" }), _jsx("div", { className: "text-sm text-[color:var(--ink-dim)]", children: taxYear ? `ปีภาษีอ้างอิง: ${taxYear}` : 'ปีภาษีอ้างอิง: -' })] }), _jsx(ExportPDF, { state: data })] }), _jsxs("section", { className: "grid gap-6", children: [_jsx(Card, { title: "\u0E02\u0E49\u0E2D\u0E21\u0E39\u0E25\u0E1A\u0E23\u0E34\u0E29\u0E31\u0E17 (\u0E2A\u0E23\u0E38\u0E1B)", children: _jsxs("div", { className: "grid grid-cols-1 md:grid-cols-2 gap-4", children: [_jsxs("div", { className: "rounded-lg bg-white/5 p-3", children: [_jsx("div", { className: "text-[10px] text-[color:var(--ink-dim)]", children: "\u0E0A\u0E37\u0E48\u0E2D\u0E1A\u0E23\u0E34\u0E29\u0E31\u0E17" }), _jsx("div", { className: "text-sm font-medium", children: c.name || '-' })] }), _jsxs("div", { className: "rounded-lg bg-white/5 p-3", children: [_jsx("div", { className: "text-[10px] text-[color:var(--ink-dim)]", children: "\u0E01\u0E33\u0E44\u0E23\u0E01\u0E48\u0E2D\u0E19\u0E20\u0E32\u0E29\u0E35" }), _jsx("div", { className: "text-sm font-medium text-right", children: fmt(pbt_before) })] }), _jsxs("div", { className: "rounded-lg bg-white/5 p-3 md:col-span-2", children: [_jsxs("div", { className: "flex items-center justify-between", children: [_jsx("div", { className: "text-[10px] text-[color:var(--ink-dim)]", children: "\u0E20\u0E32\u0E29\u0E35\u0E07\u0E1A\u0E08\u0E23\u0E34\u0E07" }), _jsx("div", { className: "text-sm font-medium", children: _jsx(Num, { v: trueTax_before }) })] }), _jsxs("div", { className: "mt-1 flex items-center justify-between", children: [_jsx("div", { className: "text-[10px] text-[color:var(--ink-dim)]", children: "\u0E04\u0E48\u0E32\u0E1A\u0E27\u0E01\u0E01\u0E25\u0E31\u0E1A (\u0E04\u0E32\u0E14\u0E04\u0E30\u0E40\u0E19\u0E08\u0E32\u0E01\u0E07\u0E1A\u0E08\u0E23\u0E34\u0E07)" }), _jsx("div", { className: "text-sm font-medium", children: _jsx(Num, { v: disallow_base }) })] })] }), _jsxs("div", { className: "rounded-lg bg-white/5 p-3", children: [_jsx("div", { className: "text-[10px] text-[color:var(--ink-dim)]", children: "\u0E01\u0E33\u0E44\u0E23\u0E01\u0E48\u0E2D\u0E19\u0E20\u0E32\u0E29\u0E35 (\u0E2B\u0E25\u0E31\u0E07\u0E2F: \u0E40\u0E1A\u0E35\u0E49\u0E22 + \u0E20\u0E32\u0E29\u0E35\u0E2D\u0E2D\u0E01\u0E41\u0E17\u0E19)" }), _jsx("div", { className: "text-sm font-semibold text-right text-gold", children: fmt(pbt_afterPremGross) })] }), _jsxs("div", { className: "rounded-lg bg-white/5 p-3", children: [_jsx("div", { className: "text-[10px] text-[color:var(--ink-dim)]", children: "\u0E20\u0E32\u0E29\u0E35 (\u0E2B\u0E25\u0E31\u0E07\u0E2F: \u0E40\u0E1A\u0E35\u0E49\u0E22 + \u0E20\u0E32\u0E29\u0E35\u0E2D\u0E2D\u0E01\u0E41\u0E17\u0E19)" }), _jsx("div", { className: "text-sm font-semibold text-right text-gold", children: fmt(trueTax_afterPremGross) })] }), _jsxs("div", { className: "rounded-lg bg-white/5 p-3 md:col-span-2", children: [_jsx("div", { className: "text-[10px] text-[color:var(--ink-dim)]", children: "\u0E20\u0E32\u0E29\u0E35\u0E25\u0E14\u0E25\u0E07 (\u0E2B\u0E25\u0E31\u0E07\u0E2F: \u0E40\u0E1A\u0E35\u0E49\u0E22 + \u0E20\u0E32\u0E29\u0E35\u0E2D\u0E2D\u0E01\u0E41\u0E17\u0E19)" }), _jsxs("div", { className: "text-sm font-semibold text-right text-gold", children: [fmt(taxSaved_afterPremGross), ' ', _jsxs("span", { className: "text-[10px] text-gold/80", children: ["(", trueTax_before > 0 ? taxSavedPct_afterPremGross.toFixed(2) : '0.00', "%)"] })] })] })] }) }), _jsx(Card, { title: "\u0E23\u0E32\u0E22\u0E08\u0E48\u0E32\u0E22\u0E1A\u0E23\u0E34\u0E29\u0E31\u0E17 (\u0E41\u0E1C\u0E19\u0E17\u0E35\u0E48\u0E40\u0E2A\u0E19\u0E2D)", children: _jsxs("div", { className: "grid grid-cols-1 md:grid-cols-3 gap-4", children: [_jsxs("div", { className: "rounded-lg bg-white/5 p-3", children: [_jsx("div", { className: "text-[10px] text-[color:var(--ink-dim)]", children: "\u0E40\u0E1A\u0E35\u0E49\u0E22\u0E23\u0E27\u0E21\u0E17\u0E31\u0E49\u0E07\u0E2B\u0E21\u0E14" }), _jsx("div", { className: "text-sm font-medium text-right", children: fmt(totalPremium) })] }), _jsxs("div", { className: "rounded-lg bg-white/5 p-3", children: [_jsx("div", { className: "text-[10px] text-[color:var(--ink-dim)]", children: "\u0E20\u0E32\u0E29\u0E35\u0E2D\u0E2D\u0E01\u0E41\u0E17\u0E19\u0E17\u0E31\u0E49\u0E07\u0E2B\u0E21\u0E14" }), _jsx("div", { className: "text-sm font-medium text-right", children: fmt(totalGrossUp) })] }), _jsxs("div", { className: "rounded-lg bg-white/5 p-3", children: [_jsx("div", { className: "text-[10px] text-[color:var(--ink-dim)]", children: "\u0E40\u0E1A\u0E35\u0E49\u0E22\u0E23\u0E27\u0E21 + \u0E20\u0E32\u0E29\u0E35\u0E2D\u0E2D\u0E01\u0E41\u0E17\u0E19\u0E17\u0E31\u0E49\u0E07\u0E2B\u0E21\u0E14" }), _jsx("div", { className: "text-sm font-medium text-right", children: fmt(totalPremium + totalGrossUp) })] })] }) }), _jsx("section", { id: "cit-table-sec", children: _jsxs(Card, { title: `ภ.ง.ด.50 ของบริษัทจำกัด${taxYear ? ` — ปีภาษี ${taxYear}` : ''}`, children: [_jsx("div", { className: "overflow-x-auto", children: _jsxs("table", { className: "min-w-full text-sm table", children: [_jsx("thead", { className: "text-[color:var(--ink-dim)]", children: _jsxs("tr", { children: [_jsx("th", { className: "py-2 pr-3 text-left", children: "\u0E23\u0E32\u0E22\u0E01\u0E32\u0E23 (\u0E20.\u0E07.\u0E14.50)" }), _jsx("th", { className: "py-2 pr-3 text-right", children: "\u0E01\u0E48\u0E2D\u0E19\u0E40\u0E02\u0E49\u0E32\u0E23\u0E48\u0E27\u0E21\u0E42\u0E04\u0E23\u0E07\u0E01\u0E32\u0E23\u0E2F" }), _jsx("th", { className: "py-2 pr-3 text-right", children: "\u0E2B\u0E25\u0E31\u0E07\u0E2F: \u0E21\u0E35\u0E40\u0E1A\u0E35\u0E49\u0E22" }), _jsx("th", { className: "py-2 pr-3 text-right", children: "\u0E2B\u0E25\u0E31\u0E07\u0E2F: \u0E40\u0E1A\u0E35\u0E49\u0E22 + \u0E20\u0E32\u0E29\u0E35\u0E2D\u0E2D\u0E01\u0E41\u0E17\u0E19" })] }) }), _jsxs("tbody", { className: "align-top", children: [_jsxs("tr", { children: [_jsx("td", { className: "py-2 pr-3 text-left", children: "\u0E23\u0E32\u0E22\u0E44\u0E14\u0E49\u0E23\u0E27\u0E21 (\u0E1A\u0E32\u0E17/\u0E1B\u0E35)" }), _jsx("td", { className: "py-2 pr-3 text-right", children: _jsx(Num, { v: income }) }), _jsx("td", { className: "py-2 pr-3 text-right", children: _jsx(Num, { v: income }) }), _jsx("td", { className: "py-2 pr-3 text-right", children: _jsx(Num, { v: income }) })] }), _jsxs("tr", { className: "text-[#FF7B7B]", children: [_jsx("td", { className: "py-2 pr-3 text-left", children: "\u0E40\u0E1A\u0E35\u0E49\u0E22\u0E1B\u0E23\u0E30\u0E01\u0E31\u0E19\u0E2F\u0E01\u0E23\u0E21\u0E18\u0E23\u0E23\u0E21\u0E4C\u0E19\u0E34\u0E15\u0E34\u0E1A\u0E38\u0E04\u0E04\u0E25 (\u0E1A\u0E32\u0E17/\u0E1B\u0E35)" }), _jsx("td", { className: "py-2 pr-3 text-right", children: _jsx(Num, { v: 0 }) }), _jsx("td", { className: "py-2 pr-3 text-right", children: _jsx(Num, { v: -totalPremium, forceNeg: true }) }), _jsx("td", { className: "py-2 pr-3 text-right", children: _jsx(Num, { v: -totalPremium, forceNeg: true }) })] }), _jsxs("tr", { className: "text-[#FF7B7B]", children: [_jsx("td", { className: "py-2 pr-3 text-left", children: "\u0E04\u0E48\u0E32\u0E20\u0E32\u0E29\u0E35\u0E2D\u0E2D\u0E01\u0E41\u0E17\u0E19\u0E17\u0E38\u0E01\u0E17\u0E2D\u0E14 (\u0E20.\u0E07.\u0E14.50(1)) (\u0E1A\u0E32\u0E17/\u0E1B\u0E35)" }), _jsx("td", { className: "py-2 pr-3 text-right", children: _jsx(Num, { v: 0 }) }), _jsx("td", { className: "py-2 pr-3 text-right", children: _jsx(Num, { v: 0 }) }), _jsx("td", { className: "py-2 pr-3 text-right", children: _jsx(Num, { v: -totalGrossUp, forceNeg: true }) })] }), _jsxs("tr", { className: "text-[#FF7B7B]", children: [_jsx("td", { className: "py-2 pr-3 text-left", children: "\u0E23\u0E32\u0E22\u0E08\u0E48\u0E32\u0E22\u0E2D\u0E37\u0E48\u0E19 (\u0E23\u0E27\u0E21\u0E04\u0E48\u0E32\u0E43\u0E0A\u0E49\u0E08\u0E48\u0E32\u0E22 + \u0E14\u0E2D\u0E01\u0E40\u0E1A\u0E35\u0E49\u0E22)" }), _jsx("td", { className: "py-2 pr-3 text-right", children: _jsx(Num, { v: -(otherCosts_before), forceNeg: true }) }), _jsx("td", { className: "py-2 pr-3 text-right", children: _jsx(Num, { v: -(otherCosts_afterPrem), forceNeg: true }) }), _jsx("td", { className: "py-2 pr-3 text-right", children: _jsx(Num, { v: -(otherCosts_afterPremGross), forceNeg: true }) })] }), _jsxs("tr", { children: [_jsx("td", { className: "py-2 pr-3 text-left", children: "\u0E01\u0E33\u0E44\u0E23\u0E01\u0E48\u0E2D\u0E19\u0E20\u0E32\u0E29\u0E35 (\u0E1A\u0E32\u0E17/\u0E1B\u0E35)" }), _jsx("td", { className: "py-2 pr-3 text-right", children: _jsx(Num, { v: pbt_before }) }), _jsx("td", { className: "py-2 pr-3 text-right", children: _jsx(Num, { v: pbt_afterPrem }) }), _jsx("td", { className: "py-2 pr-3 text-right", children: _jsx(Num, { v: pbt_afterPremGross }) })] }), _jsxs("tr", { className: "text-[#FF7B7B]", children: [_jsx("td", { className: "py-2 pr-3 text-left", children: "\u0E40\u0E2A\u0E35\u0E22\u0E20\u0E32\u0E29\u0E35\u0E19\u0E34\u0E15\u0E34\u0E1A\u0E38\u0E04\u0E04\u0E25 (\u0E1A\u0E32\u0E17/\u0E1B\u0E35) \u0E10\u0E32\u0E19 20%" }), _jsx("td", { className: "py-2 pr-3 text-right", children: _jsx(Num, { v: cit_before, forceNeg: true }) }), _jsx("td", { className: "py-2 pr-3 text-right", children: _jsx(Num, { v: cit_afterPrem, forceNeg: true }) }), _jsx("td", { className: "py-2 pr-3 text-right", children: _jsx(Num, { v: cit_afterPremGross, forceNeg: true }) })] }), _jsxs("tr", { className: "text-[#FF7B7B]", children: [_jsx("td", { className: "py-2 pr-3 text-left", children: "\u0E20\u0E32\u0E29\u0E35\u0E40\u0E07\u0E34\u0E19\u0E44\u0E14\u0E49\u0E17\u0E35\u0E48\u0E40\u0E2A\u0E35\u0E22\u0E08\u0E23\u0E34\u0E07 (\u0E1A\u0E32\u0E17/\u0E1B\u0E35)" }), _jsx("td", { className: "py-2 pr-3 text-right", children: _jsx(Num, { v: trueTax_before, forceNeg: true }) }), _jsx("td", { className: "py-2 pr-3 text-right", children: _jsx(Num, { v: trueTax_afterPrem, forceNeg: true }) }), _jsx("td", { className: "py-2 pr-3 text-right", children: _jsx(Num, { v: trueTax_afterPremGross, forceNeg: true }) })] }), _jsxs("tr", { children: [_jsx("td", { className: "py-2 pr-3 text-left", children: "\u0E01\u0E33\u0E44\u0E23(\u0E02\u0E32\u0E14\u0E17\u0E38\u0E19) \u0E2A\u0E38\u0E17\u0E18\u0E34 (\u0E1A\u0E32\u0E17/\u0E1B\u0E35)" }), _jsx("td", { className: "py-2 pr-3 text-right", children: _jsx(Num, { v: pbt_before - trueTax_before }) }), _jsx("td", { className: "py-2 pr-3 text-right", children: _jsx(Num, { v: pbt_afterPrem - trueTax_afterPrem }) }), _jsx("td", { className: "py-2 pr-3 text-right", children: _jsx(Num, { v: pbt_afterPremGross - trueTax_afterPremGross }) })] }), _jsxs("tr", { className: "text-gold font-bold", children: [_jsx("td", { className: "py-2 pr-3 text-left", children: "\u0E20\u0E32\u0E29\u0E35\u0E17\u0E35\u0E48\u0E25\u0E14\u0E25\u0E07" }), _jsx("td", { className: "py-2 pr-3 text-right", children: "-" }), _jsx("td", { className: "py-2 pr-3 text-right", children: _jsx(Num, { v: taxSaved_afterPrem }) }), _jsx("td", { className: "py-2 pr-3 text-right", children: _jsx(Num, { v: taxSaved_afterPremGross }) })] }), _jsxs("tr", { className: "text-gold font-bold", children: [_jsx("td", { className: "py-2 pr-3 text-left", children: "% \u0E17\u0E35\u0E48\u0E25\u0E14\u0E25\u0E07" }), _jsx("td", { className: "py-2 pr-3 text-right", children: "-" }), _jsx("td", { className: "py-2 pr-3 text-right", children: _jsx("span", { className: "block text-right", children: trueTax_before > 0 ? taxSavedPct_afterPrem.toFixed(2) + '%' : '-' }) }), _jsx("td", { className: "py-2 pr-3 text-right", children: _jsx("span", { className: "block text-right", children: trueTax_before > 0 ? taxSavedPct_afterPremGross.toFixed(2) + '%' : '-' }) })] })] })] }) }), _jsx("p", { className: "mt-2 text-xs text-[color:var(--ink-dim)]", children: "\u0E2B\u0E21\u0E32\u0E22\u0E40\u0E2B\u0E15\u0E38: \u0E23\u0E32\u0E22\u0E08\u0E48\u0E32\u0E22\u0E2D\u0E37\u0E48\u0E19 = \u0E04\u0E48\u0E32\u0E43\u0E0A\u0E49\u0E08\u0E48\u0E32\u0E22\u0E23\u0E27\u0E21 + \u0E14\u0E2D\u0E01\u0E40\u0E1A\u0E35\u0E49\u0E22 (\u0E23\u0E27\u0E21\u0E40\u0E1B\u0E47\u0E19\u0E41\u0E16\u0E27\u0E40\u0E14\u0E35\u0E22\u0E27\u0E40\u0E1E\u0E37\u0E48\u0E2D\u0E04\u0E27\u0E32\u0E21\u0E01\u0E23\u0E30\u0E0A\u0E31\u0E1A\u0E43\u0E19\u0E01\u0E32\u0E23\u0E19\u0E33\u0E40\u0E2A\u0E19\u0E2D)" })] }) }), _jsx(Card, { title: "\u0E15\u0E32\u0E23\u0E32\u0E07\u0E1C\u0E39\u0E49\u0E1A\u0E23\u0E34\u0E2B\u0E32\u0E23 (\u0E1C\u0E25\u0E01\u0E23\u0E30\u0E17\u0E1A\u0E20\u0E32\u0E29\u0E35\u0E23\u0E32\u0E22\u0E1A\u0E38\u0E04\u0E04\u0E25)", children: _jsx("div", { className: "overflow-x-auto", children: _jsxs("table", { className: "min-w-full text-sm table", children: [_jsx("thead", { className: "text-[color:var(--ink-dim)]", children: _jsxs("tr", { children: [_jsx("th", { className: "py-2 pr-3 text-left", children: "\u0E1C\u0E39\u0E49\u0E1A\u0E23\u0E34\u0E2B\u0E32\u0E23" }), _jsx("th", { className: "py-2 pr-3 text-right", children: "\u0E40\u0E07\u0E34\u0E19\u0E44\u0E14\u0E49\u0E1E\u0E36\u0E07\u0E1B\u0E23\u0E30\u0E40\u0E21\u0E34\u0E19 \u0E21.40(1)" }), _jsx("th", { className: "py-2 pr-3 text-right", children: "PIT \u0E01\u0E48\u0E2D\u0E19\u0E2F" }), _jsx("th", { className: "py-2 pr-3 text-right", children: "\u0E40\u0E07\u0E34\u0E19\u0E2A\u0E38\u0E17\u0E18\u0E34 \u0E01\u0E48\u0E2D\u0E19\u0E2F" }), _jsx("th", { className: "py-2 pr-3 text-right", children: "PIT \u0E2B\u0E25\u0E31\u0E07\u0E2F: \u0E40\u0E1A\u0E35\u0E49\u0E22 + \u0E20\u0E32\u0E29\u0E35\u0E2D\u0E2D\u0E01\u0E41\u0E17\u0E19" }), _jsx("th", { className: "py-2 pr-3 text-right", children: "\u0E20\u0E32\u0E29\u0E35\u0E2D\u0E2D\u0E01\u0E41\u0E17\u0E19\u0E17\u0E38\u0E01\u0E17\u0E2D\u0E14" }), _jsx("th", { className: "py-2 pr-3 text-right", children: "\u0E40\u0E07\u0E34\u0E19\u0E2A\u0E38\u0E17\u0E18\u0E34 \u0E2B\u0E25\u0E31\u0E07\u0E2F: \u0E40\u0E1A\u0E35\u0E49\u0E22 + \u0E20\u0E32\u0E29\u0E35\u0E2D\u0E2D\u0E01\u0E41\u0E17\u0E19" }), _jsx("th", { className: "py-2 pr-3 text-right", children: "\u0E44\u0E14\u0E49\u0E01\u0E23\u0E21\u0E18\u0E23\u0E23\u0E21\u0E4C\u0E08\u0E32\u0E01\u0E04\u0E48\u0E32\u0E40\u0E1A\u0E35\u0E49\u0E22" })] }) }), _jsxs("tbody", { className: "align-top", children: [ds.length === 0 && (_jsx("tr", { children: _jsx("td", { colSpan: 8, className: "py-3 text-center text-[color:var(--ink-dim)]", children: "\u0E22\u0E31\u0E07\u0E44\u0E21\u0E48\u0E21\u0E35\u0E02\u0E49\u0E2D\u0E21\u0E39\u0E25\u0E1C\u0E39\u0E49\u0E1A\u0E23\u0E34\u0E2B\u0E32\u0E23" }) })), ds.map(it => {
                                                const base = it.annualSalary ?? 0;
                                                const prem = it.personalInsurancePremium ?? 0;
                                                // ก่อนฯ
                                                const tax1 = Math.max(0, base - personalExpense - personalAllowance);
                                                const pit1 = pitTax(tax1);
                                                const netY1 = base - pit1;
                                                // หลังฯ: เบี้ย + ภาษีออกแทน
                                                const g3 = progressiveGrossUp(base, prem, personalExpense + personalAllowance);
                                                const tax3 = Math.max(0, base + prem + g3 - personalExpense - personalAllowance);
                                                const pit3 = pitTax(tax3);
                                                const netY3 = base - pit3 + g3;
                                                return (_jsxs("tr", { children: [_jsx("td", { className: "py-2 pr-3 text-left", children: it.name || '-' }), _jsx("td", { className: "py-2 pr-3 text-right", children: _jsx(Num, { v: base }) }), _jsx("td", { className: "py-2 pr-3 text-right text-[#FF7B7B]", children: _jsx(Num, { v: pit1, forceNeg: true }) }), _jsx("td", { className: "py-2 pr-3 text-right", children: _jsx(Num, { v: netY1 }) }), _jsx("td", { className: "py-2 pr-3 text-right text-[#FF7B7B]", children: _jsx(Num, { v: pit3, forceNeg: true }) }), _jsx("td", { className: "py-2 pr-3 text-right", children: _jsx(Num, { v: g3 }) }), _jsx("td", { className: "py-2 pr-3 text-right text-gold font-semibold", children: _jsx(Num, { v: netY3 }) }), _jsx("td", { className: "py-2 pr-3 text-right", children: _jsx(Num, { v: prem }) })] }, it.id));
                                            })] })] }) }) })] }), _jsxs("section", { className: "mt-8", children: [_jsx("h3", { className: "text-lg font-semibold text-gold mb-3", children: "\u0E02\u0E49\u0E2D\u0E2B\u0E32\u0E23\u0E37\u0E2D\u0E2A\u0E23\u0E23\u0E1E\u0E32\u0E01\u0E23\u0E17\u0E35\u0E48\u0E40\u0E01\u0E35\u0E48\u0E22\u0E27\u0E02\u0E49\u0E2D\u0E07" }), _jsx("ul", { className: "space-y-2", children: RULINGS.slice(0, 2).map((r, i) => (_jsxs("li", { className: "flex items-start gap-3", children: [_jsxs("span", { className: "mt-0.5 text-[color:var(--ink-dim)]", children: [i + 1, "."] }), _jsxs("div", { className: "min-w-0", children: [_jsx("a", { href: r.url, target: "_blank", rel: "noopener noreferrer", className: "text-gold hover:underline break-words", title: `${r.docNo} • ${r.topic}`, children: r.docNo }), _jsxs("span", { className: "ml-2 text-[color:var(--ink)]", children: ["\u0E40\u0E23\u0E37\u0E48\u0E2D\u0E07: ", r.topic] }), _jsxs("div", { className: "text-xs text-[color:var(--ink-dim)]", children: ["\u0E41\u0E19\u0E27\u0E27\u0E34\u0E19\u0E34\u0E08\u0E09\u0E31\u0E22: ", r.summary] })] })] }, r.docNo))) })] })] }));
}
